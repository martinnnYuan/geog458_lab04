<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Lab 04 – Tile Map Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }

    /* Simple UI panels */
    .panel {
      position: absolute;
      z-index: 999;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(4px);
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 10px;
      padding: 12px 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.10);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: #111;
    }

    #info {
      top: 12px;
      left: 12px;
      max-width: 320px;
      line-height: 1.35;
    }
    #info h1 {
      font-size: 16px;
      margin: 0 0 6px 0;
      font-weight: 700;
    }
    #info p {
      margin: 0;
      font-size: 13px;
      color: #333;
    }

    #opacityBox {
      bottom: 12px;
      left: 12px;
      width: 240px;
    }
    #opacityBox label {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-bottom: 6px;
    }
    #opacityBox input[type="range"] {
      width: 100%;
    }

    /* Make Leaflet layer control a bit cleaner */
    .leaflet-control-layers {
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.10);
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <!-- Simple title/description -->
  <div id="info" class="panel">
    <h1>Lab 04: Map Tiles</h1>
    <p>
      Four locally-hosted raster tilesets (tileset1–tileset4).<br />
      Use the layer control (top-right) to switch styles.
    </p>
  </div>

  <!-- Opacity slider -->
  <div id="opacityBox" class="panel">
    <label>
      <span>Layer opacity</span>
      <span id="opacityValue">100%</span>
    </label>
    <input id="opacitySlider" type="range" min="0" max="100" value="100" />
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    /**
     * ✅ IMPORTANT: Adjust these to your tiles' region
     * - If you don’t know the center, open the map, guess, then refine.
     */
    const initialCenter = [47.6062, -122.3321]; // example: Seattle
    const initialZoom = 11;

    // Create the map
    const map = L.map("map", {
      center: initialCenter,
      zoom: initialZoom,
      zoomControl: true
    });
    
    const commonTileOptions = {
      minZoom: 0,
      maxZoom: 16,   // change if you generated deeper zooms
      tms: false,    // set true only if your tiles are TMS (flipped y)
      noWrap: true,  // prevents repeating world horizontally
      attribution: "Generated tiles (Lab 04)"
    };

    const tileset1 = L.tileLayer("tileset1/{z}/{x}/{y}.png", commonTileOptions);
    const tileset2 = L.tileLayer("tileset2/{z}/{x}/{y}.png", commonTileOptions);
    const tileset3 = L.tileLayer("tileset3/{z}/{x}/{y}.png", commonTileOptions);
    const tileset4 = L.tileLayer("tileset4/{z}/{x}/{y}.png", commonTileOptions);

    // Default layer on load
    let activeLayer = tileset1.addTo(map);

    // Layer control (top-right)
    const baseLayers = {
      "Tileset 1": tileset1,
      "Tileset 2": tileset2,
      "Tileset 3": tileset3,
      "Tileset 4": tileset4
    };
    L.control.layers(baseLayers, null, { collapsed: false }).addTo(map);

    // Scale bar (bottom-left)
    L.control.scale({ metric: true, imperial: false }).addTo(map);

    /**
     * Opacity slider for the currently active layer
     */
    const slider = document.getElementById("opacitySlider");
    const opacityValue = document.getElementById("opacityValue");

    function setLayerOpacity(val01) {
      if (!activeLayer) return;
      activeLayer.setOpacity(val01);
      opacityValue.textContent = Math.round(val01 * 100) + "%";
    }

    slider.addEventListener("input", (e) => {
      const v = Number(e.target.value) / 100;
      setLayerOpacity(v);
    });

    // Update active layer reference when user switches base layer
    map.on("baselayerchange", (e) => {
      activeLayer = e.layer;
      // re-apply current slider value to the newly selected layer
      setLayerOpacity(Number(slider.value) / 100);
    });

    /**
     * Optional: Helpful console message if tiles are missing
     * (Open DevTools -> Console)
     */
    map.on("tileerror", (err) => {
      console.warn("Tile load error:", err);
      console.warn(
        "Check your tile folder path and file extension. " +
        "Also check if you need tms:true (y flipped)."
      );
    });
  </script>
</body>
</html>
